<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <link rel="stylesheet" type="text/css" href="style3.css">
  <title>Main Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</head>

<body>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
  <script src="./modules/firebaseConfig.js"></script>
   <header>
    <div id="leftbar">
      <img src="./icon/profile.jpg" alt="profile">
       <div class="logout">
         <button type="submit" class="btn btn-default btn-sm" onclick="showModal()">
         <span class="glyphicon glyphicon-log-out"></span></button></a>
      </div>
      </div>
      <div id="logoutModal" class="modal">
        <h3>你確定要登出嗎？</h3>
        <div class="modal-buttons">
          <button class="yes-btn" onclick="confirmLogout()">是</button>
          <button class="no-btn" onclick="closeModal()">否</button>
        </div>
      </div>

      <script>
        // 顯示彈窗
        function showModal() {
          window.open("account.html")
          //document.getElementById('logoutModal').style.display = 'block';
        }

        // 關閉彈窗
        function closeModal() {
          document.getElementById('logoutModal').style.display = 'none';
        }

        // 確認登出，跳轉到登入頁面
        function confirmLogout() {
          window.location.href = 'login.html'; // 假設返回到登入頁面
        }
      </script>
    <div id="upperbar">
    </div>
  </header>

  <div class="course" id="1">
    <img src="./icon/1.jpg" alt="課程一">
    <div class="text-info">
      <h2><strong>瞭解你自己的英語程度</strong></h2>
      <p>Learn the Basics</p>
      <button class="info-button" onclick="showInfo(1)">瞭解詳情</button>
    </div>
    <div class="text-area">
      <p>課程公告顯示區:</p>
      <span id="lastAnn"></span>
    </div>
  </div>

  <div class="course" id="2">
    <img src="./icon/2.jpg" alt="課程二">
    <div class="text-info">
      <h2><strong>醫療用語教學</strong></h2>
      <p>教你如何描述自身的病症</p>
      <button class="info-button" onclick="showInfo(2)">瞭解詳情</button>
    </div>
    <div class="text-area">
      <p>課程公告顯示區:</p>
      <span id="lastAnn"></span>
    </div>
  </div>

  <div class="course" id="3">
    <img src="./icon/3.jpg" alt="課程三">
    <div class="text-info">
      <h2><strong>商業英文</strong></h2>
      <p>教導你在面試或工作時的英文用語</p>
      <button class="info-button" onclick="showInfo(3)">瞭解詳情</button>
    </div>
    <div class="text-area">
      <p>課程公告顯示區:</p>
      <span id="lastAnn"></span>
    </div>
  </div>

  <div id="sidebar" class="hidden">
    <img src="./icon/books.jpg" alt="english level">
    <div class="class-info">
      <h2 id="course-info"></h2>
      <button id="teacher-info" class="teacher">
        <img src="" alt="Teacher Image">
        <span id="teacher-name" ></span>
      </button>
      
      <h4 id="Class-Teacher"><strong></strong></h4>
      <h4 id="Course-Introduction"><strong></strong></h4>
      <p id="Course-Detail"></p>

      <script>
        document.getElementById("teacher-info").addEventListener("click", function() {
          window.open("data.html", "_blank");
        });
      </script>

    </div>
    <button class="open-course-button second-button" onclick="openCourse()"><strong>瞭解課程</strong></button>
    <script>
      function openCourse(){
        window.open("Timetable.html");
      }
    </script>
    <button class="open-course-button" onclick="openClass()"><strong>進入房間</strong></button>
    <script>
      function openClass(){
        window.open("VideoCallPage.html");
      }
    </script>

  </div>
  <script >
    var courseData = {
      "Course 1": {
        teacherName: "點擊瞭解：陳老師",
        teacherImage: "./icon/victor.png",
        Course: "瞭解你自己的英語程度",
        ClassName: "SelfUnderstanding",
        ClassTeacher: "授課老師：陳老師",
        CourseIntroduction: "課程簡介：",
        CourseDetail: "本課程幫助學生瞭解自己的英文水平<br>老師將進行簡單的交流后判斷學生目前的英語水平，並對此定制符合程度的英語課程！"

      },
      "Course 2": {
        teacherName: "點擊瞭解：蔡老師",
        teacherImage: "./icon/victor.png",
        Course: "醫療用語教學",
        Document: "BasicMedicalEnglish",
        ClassName: "MedicalEnglish",
        ClassTeacher: "授課老師：蔡老師",
        CourseIntroduction: "課程簡介：",
        CourseDetail: "本課程旨在幫助學生掌握醫療領域中常用的英文詞匯和專業術語，增進醫護溝通技巧。課程内容包含病患對話、醫學診斷、治療和藥物用語，適合準備入醫療行業或計劃在國外生活留學的學生。"

      },
      "Course 3": {
        teacherName: "點擊瞭解：林老師",
        teacherImage: "./icon/victor.png",
        Course: "商業英文",
        ClassName: "BunsinessEnglish",
        ClassTeacher: "授課老師：林老師",
        CourseIntroduction: "課程簡介：",
        CourseDetail: "本課程專注於商業場合的英文應用，内容涵蓋商務交流、會議表達、商業寫作和談判技巧，幫助學生在國際商業環境中自信表達和有效溝通。適合有志於提升商業英文技能的學員，包括公司職員和想要進入商業領域的學生。"

      }
    };

    function showInfo(courseNumber) {
      let courseName = "Course " + courseNumber;

      if (courseData[courseName]) {
        const courseInfo = courseData[courseName];
        document.getElementById("teacher-name").textContent = courseInfo.teacherName;
        document.getElementById("teacher-info").querySelector("img").src = courseInfo.teacherImage;
        document.getElementById("course-info").textContent = courseInfo.Course;
        document.getElementById("sidebar").classList.remove("hidden");
        sessionStorage.setItem("TargetPDF" , courseInfo.Document)
        sessionStorage.setItem("Class" , courseInfo.ClassName)

        document.getElementById("Class-Teacher").textContent = courseInfo.ClassTeacher;
        document.getElementById("Course-Introduction").textContent = courseInfo.CourseIntroduction;
        document.getElementById("Course-Detail").innerHTML = courseInfo.CourseDetail;

      }
    }

    const app = firebase.initializeApp(firebaseConfig)
    // Initialize Realtime Database and get a reference to the service
    const database = firebase.database(app);

    let path = []

    Object.keys(courseData).forEach(data => {
      path.push('/' + courseData[data].ClassName + '/Announcement/')
    });
    path.forEach((data,index) =>{
      const textBlock = document.getElementById(index+1).querySelector('#lastAnn')
      database.ref(data).on('value' , (snapshot) => {
        let array = []
        snapshot.forEach((context) =>{
          array.push(context.val().context)
        })
        console.log(array)
        if(textBlock !== null) textBlock.textContent = array[array.length -1]
        else console.log("cannot find textBlock")
        //console.log(snapshot.at(-1))
      },{
        //once:true
      });
    })
  </script>
</body>
</html>
